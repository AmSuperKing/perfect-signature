var __renderjsModules={};
__renderjsModules["21c2acae"]=(()=>{var P=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var et=Object.prototype.hasOwnProperty;var nt=(s,n)=>{for(var t in n)P(s,t,{get:n[t],enumerable:!0})},it=(s,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of Z(n))!et.call(s,i)&&i!==t&&P(s,i,{get:()=>n[i],enumerable:!(e=G(n,i))||e.enumerable});return s};var at=s=>it(P({},"__esModule",{value:!0}),s);var gt={};nt(gt,{default:()=>ft});function j(s,n){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(s);n&&(e=e.filter(function(i){return Object.getOwnPropertyDescriptor(s,i).enumerable})),t.push.apply(t,e)}return t}function st(s){for(var n=1;arguments.length>n;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?j(Object(t),!0).forEach(function(e){ot(s,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):j(Object(t)).forEach(function(e){Object.defineProperty(s,e,Object.getOwnPropertyDescriptor(t,e))})}return s}function T(s){return T=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},T(s)}function b(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")}function B(s,n){for(var t=0;n.length>t;t++){var e=n[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(s,e.key,e)}}function E(s,n,t){return n&&B(s.prototype,n),t&&B(s,t),Object.defineProperty(s,"prototype",{writable:!1}),s}function ot(s,n,t){return n in s?Object.defineProperty(s,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[n]=t,s}function $(s,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(n&&n.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),n&&C(s,n)}function D(s){return D=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},D(s)}function C(s,n){return C=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},C(s,n)}function rt(s,n){if(n&&(typeof n=="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(s)}function q(s){var n=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=D(s);if(n){var i=D(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return rt(this,t)}}var U=function(s){var n=T(s);return s!==null&&n==="object"||n==="function"},ht={}.toString,I=function(s,n){return ht.call(s)==="[object "+n+"]"},V=function(s){return I(s,"String")},X=function(s){return I(s,"Number")},O=function(s){return I(s,"Function")},W=function(){function s(){b(this,s),this.__events=void 0,this.__events={}}return E(s,[{key:"on",value:function(n,t){if(n&&t){var e=this.__events[n]||[];e.push(t),this.__events[n]=e}}},{key:"emit",value:function(n,t){var e=this;if(U(n)&&(n=(t=n)&&t.type),n){var i=this.__events[n];i&&i.length&&i.forEach(function(a){a.call(e,t)})}}},{key:"off",value:function(n,t){var e=this.__events,i=e[n];if(i&&i.length)if(t)for(var a=0,o=i.length;o>a;a++)i[a]===t&&(i.splice(a,1),a--);else delete e[n]}},{key:"getEvents",value:function(){return this.__events}}]),s}(),ut=function(s){$(t,W);var n=q(t);function t(e,i){var a;return b(this,t),(a=n.call(this)).context=void 0,a.canvas=void 0,a.attrs=void 0,a.isCanvasElement=void 0,a.context=e,a.canvas=i.canvas||e.canvas||{width:i.width||0,height:i.height||0},a.attrs=i||{},a.isCanvasElement=!0,a}return E(t,[{key:"width",get:function(){return this.canvas.width},set:function(e){this.canvas.width=e}},{key:"height",get:function(){return this.canvas.height},set:function(e){this.canvas.height=e}},{key:"getContext",value:function(){return this.context}},{key:"getBoundingClientRect",value:function(){var e=this.attrs||{},i=e.top,a=e.right,o=e.width,r=e.height,h=e.left,u=e.bottom;return{top:i===void 0?0:i,width:o===void 0?0:o,right:a===void 0?0:a,height:r===void 0?0:r,bottom:u===void 0?0:u,left:h===void 0?0:h}}},{key:"setAttribute",value:function(e,i){this.attrs[e]=i}},{key:"addEventListener",value:function(e,i){this.on(e,i)}},{key:"removeEventListener",value:function(e,i){this.off(e,i)}},{key:"dispatchEvent",value:function(e,i){this.emit(e,i)}}]),t}(),ct=function(s,n){return s?function(t){if(!t||t.nodeType!==1||!t.nodeName||t.nodeName.toLowerCase()!=="canvas")return!1;var e=!1;try{t.addEventListener("eventTest",function(){e=!0}),t.dispatchEvent(new Event("eventTest"))}catch(i){e=!1}return e}(s.canvas)?s.canvas:new ut(s,n):null};function M(s,n){try{return s.currentStyle?s.currentStyle[n]:document.defaultView&&document.defaultView.getComputedStyle(s,null).getPropertyValue(n)}catch(t){return{width:300,height:150}[n]}}function Y(s,n){var t=n.get("el");if(!t)return s;var e=t.getBoundingClientRect(),i=e.top,a=i===void 0?0:i,o=e.left,r=o===void 0?0:o,h=parseFloat(M(t,"padding-left"))||0,u=parseFloat(M(t,"padding-top"))||0;return{x:s.x-r-h,y:s.y-a-u}}function H(s,n){var t=n.get("landscape");if(!t)return s;if(O(t))return t(s,n);var e=n.get("height");return{x:s.y,y:e-s.x}}var S=function(s,n){var t=s.touches;if(!t||!t.length)return[H(Y({x:s.clientX,y:s.clientY},n),n)];t.length||(t=s.changedTouches||[]);for(var e=[],i=0,a=t.length;a>i;i++){var o=t[i],r=o.x,h=o.y,u=o.clientX,c=o.clientY,l=void 0;l=X(r)||X(h)?{x:r,y:h}:Y({x:u,y:c},n),e.push(H(l,n))}return e},z=function(s,n){var t=n.x-s.x,e=n.y-s.y;return Math.abs(t)>Math.abs(e)?t>0?"right":"left":e>0?"down":"up"},L=function(s,n){var t=Math.abs(n.x-s.x),e=Math.abs(n.y-s.y);return Math.sqrt(t*t+e*e)},lt=function(){function s(n){var t=this,e=n.canvas,i=n.el;b(this,s),this.processEvent=void 0,this.canvas=void 0,this.startTime=0,this.endTime=0,this.startPoints=null,this.startDistance=0,this.center=null,this.pressTimeout=void 0,this.eventType=null,this.direction=null,this.lastMoveTime=0,this.prevMovePoints=null,this.prevMoveTime=0,this.lastMovePoints=null,this.pinch=!1,this._click=function(a){var o=S(a,t.canvas);a.points=o,t.emitEvent("click",a)},this._start=function(a){var o,r,h=S(a,t.canvas);h&&(a.points=h,t.emitEvent("touchstart",a),t.reset(),t.startTime=Date.now(),t.startPoints=h,h.length>1?(t.startDistance=L(h[0],h[1]),t.center={x:(o=h[0]).x+((r=h[1]).x-o.x)/2,y:o.y+(r.y-o.y)/2}):t.pressTimeout=setTimeout(function(){var u="press",c="none";a.direction=c,t.emitStart(u,a),t.emitEvent(u,a),t.eventType=u,t.direction=c},250))},this._move=function(a){var o=S(a,t.canvas);if(o){a.points=o,t.emitEvent("touchmove",a);var r=t.startPoints;if(r)if(o.length>1){var h=t.startDistance,u=L(o[0],o[1]);a.zoom=u/h,a.center=t.center,t.emitStart("pinch",a),t.emitEvent("pinch",a)}else{var c=o[0].x-r[0].x,l=o[0].y-r[0].y,v=t.direction||z(r[0],o[0]);t.direction=v;var d=t.getEventType(o);a.direction=v,a.deltaX=c,a.deltaY=l,t.emitStart(d,a),t.emitEvent(d,a);var g=t.lastMoveTime,f=Date.now();f-g>0&&(t.prevMoveTime=g,t.prevMovePoints=t.lastMovePoints,t.lastMoveTime=f,t.lastMovePoints=o)}}},this._end=function(a){var o=S(a,t.canvas);a.points=o,t.emitEnd(a),t.emitEvent("touchend",a);var r=t.lastMoveTime;if(100>Date.now()-r){var h=r-(t.prevMoveTime||t.startTime);if(h>0){var u=t.prevMovePoints||t.startPoints,c=t.lastMovePoints;if(!u||!c)return;var l=L(u[0],c[0])/h;l>.3&&(a.velocity=l,a.direction=z(u[0],c[0]),t.emitEvent("swipe",a))}}t.reset();var v=a.touches;v&&v.length>0&&t._start(a)},this._cancel=function(a){t.emitEvent("touchcancel",a),t.reset()},this.canvas=e,this.delegateEvent(i),this.processEvent={}}return E(s,[{key:"delegateEvent",value:function(n){n.addEventListener("click",this._click),n.addEventListener("touchstart",this._start),n.addEventListener("touchmove",this._move),n.addEventListener("touchend",this._end),n.addEventListener("touchcancel",this._cancel)}},{key:"emitEvent",value:function(n,t){this.canvas.emit(n,t)}},{key:"getEventType",value:function(n){var t,e=this.eventType,i=this.startTime,a=this.startPoints;if(e)return e;var o=this.canvas.__events.pan;if(o&&o.length){var r=Date.now();if(!a)return;t=r-i>250&&10>L(a[0],n[0])?"press":"pan"}else t="press";return this.eventType=t,t}},{key:"enable",value:function(n){this.processEvent[n]=!0}},{key:"isProcess",value:function(n){return this.processEvent[n]}},{key:"emitStart",value:function(n,t){this.isProcess(n)||(this.enable(n),this.emitEvent("".concat(n,"start"),t))}},{key:"emitEnd",value:function(n){}},{key:"clearPressTimeout",value:function(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)}},{key:"reset",value:function(){this.clearPressTimeout(),this.startTime=0,this.startPoints=null,this.startDistance=0,this.direction=null,this.eventType=null,this.pinch=!1,this.prevMoveTime=0,this.prevMovePoints=null,this.lastMoveTime=0,this.lastMovePoints=null}}]),s}(),dt=function(s){$(t,W);var n=q(t);function t(e){var i;return b(this,t),(i=n.call(this))._attrs={},i._isWindow=void 0,i._attrs=Object.assign({},e),i._isWindow=typeof window!="undefined",i._initPixelRatio(),i._initCanvas(),["createImage","toDataURL","requestAnimationFrame"].forEach(function(a){i._initAttrs(a,e.canvas||i.get("el"))}),i}return E(t,[{key:"get",value:function(e){return this._attrs[e]}},{key:"set",value:function(e,i){this._attrs[e]=i}},{key:"_initAttrs",value:function(e,i){var a=this;this.get(e)||this.set(e,function(){return i[e]?i[e].apply(i,arguments):a._isWindow?window[e]?(o=window)[e].apply(o,arguments):e=="createImage"?new Image:null:void 0;var o})}},{key:"_initCanvas",value:function(){var e,i,a=this.get("el"),o=this.get("context");if(!a&&!o)throw Error("\u8BF7\u6307\u5B9A id\u3001el \u6216 context!");e=a?V(a)?(i=a)?document.getElementById(i):null:a:ct(o,this._attrs),o&&e&&!e.getContext&&(e.getContext=function(){return o});var r=this.get("width")||function(c){var l=M(c,"width");return l==="auto"&&(l=c.offsetWidth),parseFloat(l)}(e)||e.width,h=this.get("height")||function(c){var l=M(c,"height");return l==="auto"&&(l=c.offsetHeight),parseFloat(l)}(e)||e.height;this.set("canvas",this),this.set("el",e),this.set("context",o||e.getContext("2d")),this.changeSize(r,h);var u=new lt({canvas:this,el:e,parent:this.get("parent")});this.set("eventController",u)}},{key:"_initPixelRatio",value:function(){this.get("pixelRatio")||this.set("pixelRatio",window&&window.devicePixelRatio||1)}},{key:"changeSize",value:function(e,i){var a,o=this.get("pixelRatio"),r=this.get("el");r.style&&(r.style.width=e+"px",r.style.height=i+"px"),(a=r)&&T(a)==="object"&&(a.nodeType===1&&a.nodeName||a.isCanvasElement)&&(r.width=e*o,r.height=i*o,o!==1&&this.get("context").scale(o,o)),this.set("width",e),this.set("height",i)}},{key:"destroy",value:function(){if(!this.get("destroyed")){var e=this.get("el");e.width=0,e.height=0,this.clear(),this._attrs={},this.set("destroyed",!0)}}},{key:"clear",value:function(){}},{key:"isDestroyed",value:function(){return this.get("destroyed")}}]),t}(),R={penColor:"black",backgroundColor:"",openSmooth:!0,penSize:2,minLineWidth:2,maxLineWidth:6,minSpeed:1.5,maxWidthDiffRate:20,maxHistoryLength:20},x=null,vt=function(){function s(n){var t=this;b(this,s),this.canAddHistory=!0,this.points=[],this.historyList=[],this.undoneList=[],this.canvas=void 0,this._isEmpty=!0,this.active=!1,this.getLineWidth=function(e){var i=t.get("options"),a=i.minSpeed,o=i.minLineWidth,r=t.getMaxLineWidth();return Math.min(Math.max(r-(r-o)*e/Math.max(Math.min(a,10),1),o),r)},this.drawTrapezoid=function(e,i,a,o){var r=t.get("context");r.beginPath(),r.moveTo(Number(e.x.toFixed(1)),Number(e.y.toFixed(1))),r.lineTo(Number(i.x.toFixed(1)),Number(i.y.toFixed(1))),r.lineTo(Number(a.x.toFixed(1)),Number(a.y.toFixed(1))),r.lineTo(Number(o.x.toFixed(1)),Number(o.y.toFixed(1))),r.fillStyle=t.get("options").penColor,r.fill(),r.draw&&r.draw(!0)},this.drawNoSmoothLine=function(e,i){i.lastX=e.x+.5*(i.x-e.x),i.lastY=e.y+.5*(i.y-e.y),typeof e.lastX=="number"&&t.drawCurveLine(e.lastX,e.lastY,e.x,e.y,i.lastX,i.lastY,t.getMaxLineWidth())},this.drawCurveLine=function(e,i,a,o,r,h,u){u=Number(u.toFixed(1));var c=t.get("context");c.lineWidth=u,c.beginPath(),c.moveTo(Number(e.toFixed(1)),Number(i.toFixed(1))),c.quadraticCurveTo(Number(a.toFixed(1)),Number(o.toFixed(1)),Number(r.toFixed(1)),Number(h.toFixed(1))),c.stroke(),c.draw&&c.draw(!0)},this.getRadianData=function(e,i,a,o){var r=a-e,h=o-i;if(r===0)return{val:0,pos:-1};if(h===0)return{val:0,pos:1};var u=Math.abs(Math.atan(h/r));return a>e&&i>o||e>a&&o>i?{val:u,pos:1}:{val:u,pos:-1}},this.getRadianPoints=function(e,i,a,o){if(e.val===0)return e.pos===1?[{x:i,y:a+o},{x:i,y:a-o}]:[{y:a,x:i+o},{y:a,x:i-o}];var r=Math.sin(e.val)*o,h=Math.cos(e.val)*o;return e.pos===1?[{x:i+r,y:a+h},{x:i-r,y:a-h}]:[{x:i+r,y:a-h},{x:i-r,y:a+h}]},this.drawSmoothLine=function(e,i){var a=i.x-e.x,o=i.y-e.y;if(Math.abs(a)+Math.abs(o)>2?(i.lastX1=e.x+.3*a,i.lastY1=e.y+.3*o,i.lastX2=e.x+.7*a,i.lastY2=e.y+.7*o):(i.lastX1=i.lastX2=e.x+.5*a,i.lastY1=i.lastY2=e.y+.5*o),i.perLineWidth=(e.lineWidth+i.lineWidth)/2,typeof e.lastX1=="number"){if(t.drawCurveLine(e.lastX2,e.lastY2,e.x,e.y,i.lastX1,i.lastY1,i.perLineWidth),e.isFirstPoint||e.lastX1===e.lastX2&&e.lastY1===e.lastY2)return;var r=t.getRadianData(e.lastX1,e.lastY1,e.lastX2,e.lastY2),h=t.getRadianPoints(r,e.lastX1,e.lastY1,e.perLineWidth/2),u=t.getRadianPoints(r,e.lastX2,e.lastY2,i.perLineWidth/2);t.drawTrapezoid(h[0],u[0],u[1],h[1])}else i.isFirstPoint=!0},this.addHistory=function(){var e=t.get("options").maxHistoryLength;if(e&&t.canAddHistory)if(t.canAddHistory=!1,t.get("createImage")){var i=null;i=t.get("createImage")();var a=t.get("toDataURL")&&t.get("toDataURL")();V(a)?i.src=a:a.then(function(o){i.src=o}),i.onload=function(){var o=x;x=i,t.historyList.push(o),t.historyList=t.historyList.slice(-e)}}else t.historyList.length++},this.drawByImage=function(e){var i=t.get("context"),a=t.get("width"),o=t.get("height");i.clearRect(0,0,a,o);try{e&&i.drawImage(e,0,0,a,o),i.draw&&i.draw(!0)}catch(r){t.historyList.length=0}},this.isEmpty=function(){return t.get("options").maxHistoryLength>0?t.historyList.length===0:t._isEmpty},this.clear=function(){if(!t.get("options").disabled){var e=t.get("context");e.clearRect(0,0,t.get("width"),t.get("height")),e.draw&&e.draw(),t._isEmpty=!0,x=null,t.historyList.length=0}},this.undo=function(){if(!t.get("options").disabled&&(t.get("options").maxHistoryLength===0&&t.clear(),t.get("createImage")&&t.historyList.length)){var e=t.historyList.pop();t.drawByImage(e),t.undoneList.push(x),x=e,t.historyList.length||t.undoneList.length||t.clear()}},this.redo=function(){if(t.undoneList.length&&!t.get("options").disabled){var e=t.undoneList.pop();t.historyList.push(x),t.drawByImage(e),x=e,t._isEmpty=!1}},this.canvas=n,this.canvas.set("pen",R),this.init()}return E(s,[{key:"getOption",value:function(){}},{key:"setOption",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=st({},n),e=t.maxLineWidth;if(e&&n.penSize&&e==R.maxLineWidth){var i=Math.max(e,n.penSize);t.maxLineWidth=i}this.canvas.set("pen",Object.assign({},R,t))}},{key:"get",value:function(n){return this.canvas.get(n=="options"?"pen":n)}},{key:"init",value:function(){var n=this;this.get("context").lineCap="round",this.canvas.on("touchstart",function(t){return n.onDrawStart(t)}),this.canvas.on("touchmove",function(t){return n.onDrawMove(t)}),this.canvas.on("touchend",function(t){return n.onDrawEnd(t)})}},{key:"drawBackground",value:function(){var n=this.get("context"),t=this.get("width"),e=this.get("height"),i=this.get("options"),a=i.backgroundColor,o=i.backgroundImage;a&&(n.fillStyle=a,n.fillRect(0,0,t,e),n.draw&&n.draw(!0)),o&&this.drawByImage(o)}},{key:"getImageData",value:function(n){if(n){var t=this.get("width"),e=this.get("height"),i=this.get("el"),a=i.nodeName==="CANVAS",o=a?t:i.width,r=a?e:i.height;if(a){var h=document.createElement("canvas");h.width=t,h.height=e;var u=h.getContext("2d");u.drawImage(i,0,0,t,e);var c=u.getImageData(0,0,t,e).data;return n(c)}var l,v=this.get("context").getImageData(0,0,o,r);return U(l=v)&&O(l.then)&&O(l.catch)?(v.then(function(d){return n(d.data)}),null):n(v.data)}}},{key:"getMaskedImageData",value:function(n){if(n)return this.getImageData(function(t){for(var e=0;t.length>e;e+=4)t[e+3]===0?(t[e]=0,t[e+1]=0,t[e+2]=0):(t[e]=255,t[e+1]=255,t[e+2]=255);return n(t)})}},{key:"getContentBoundingBox",value:function(n){var t=this.get("pixelRatio"),e=this.get("width"),i=this.get("height"),a=this.get("el"),o=a.nodeName==="CANVAS",r=o?e:a.width,h=o?i:a.height;return t=o?1:t,this.getImageData(function(u){for(var c=Math.floor(r),l=c,v=Math.floor(h),d=0,g=0,f=0;u.length>f;f+=4)if(u[f+3]>0){var m=f/4%c,k=Math.floor(f/4/c);l=Math.min(l,m),v=Math.min(v,k),d=Math.max(d,m),g=Math.max(g,k)}var _={width:(d-l+1)/t,height:(g-v+1)/t,startX:l/t,startY:v/t};return n&&n(_),_})}},{key:"remove",value:function(){var n=this;this.canvas.off("touchstart",function(t){return n.onDrawStart(t)}),this.canvas.off("touchmove",function(t){return n.onDrawMove(t)}),this.canvas.off("touchend",function(t){return n.onDrawEnd(t)})}},{key:"disableScroll",value:function(n){n.preventDefault&&this.get("options").disableScroll&&n.preventDefault()}},{key:"onDrawStart",value:function(n){if(!this.get("options").disabled){this.disableScroll(n),this.undoneList.length=0;var t=n.points;if(this.active){this.canAddHistory=!0,this.get("context").strokeStyle=this.get("options").penColor;var e=t[0];this.initPoint(e.x,e.y)}}}},{key:"onDrawMove",value:function(n){if(!this.get("options").disabled&&(this.disableScroll(n),this.active)){var t=n.points[0];this.initPoint(t.x,t.y),this.onDraw()}}},{key:"onDrawEnd",value:function(n){this.active&&!this.get("options").disabled&&(this.addHistory(),this.canAddHistory=!0,this.points=[])}},{key:"onDraw",value:function(){var n=this,t=this.get("context");if(this.points.length>=2){t.lineWidth=this.get("options").penSize||2;var e=this.points.slice(-1)[0],i=this.points.slice(-2,-1)[0],a=function(){n._isEmpty=!1,n.get("options").openSmooth?n.drawSmoothLine(i,e):n.drawNoSmoothLine(i,e)};a()}}},{key:"getMaxLineWidth",value:function(){var n=this.get("options");return Math.min(n.penSize,n.maxLineWidth)}},{key:"initPoint",value:function(n,t){var e={x:n,y:t,t:Date.now()},i=this.points.slice(-1)[0];if(!i||i.t!==e.t&&(i.x!==n||i.y!==t)){if(this.get("options").openSmooth&&i){var a=this.points.slice(-2,-1)[0];if(e.distance=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)),e.speed=e.distance/(e.t-i.t||.1),e.lineWidth=this.getLineWidth(e.speed),a&&a.lineWidth&&i.lineWidth){var o=(e.lineWidth-i.lineWidth)/i.lineWidth,r=this.get("options").maxWidthDiffRate/100;r=r>1?1:.01>r?.01:r,Math.abs(o)>r&&(e.lineWidth=i.lineWidth*(1+(o>0?r:-r)))}}this.points.push(e),this.points=this.points.slice(-3)}}}]),s}(),J=function(){function s(n){b(this,s),this.canvas=void 0,this._ee=void 0,this.pen=void 0;var t=new dt(n);t.set("parent",this),this.canvas=t,this._ee=new W,this.pen=new vt(t),this.init()}return E(s,[{key:"init",value:function(){this.pen.active=!0}},{key:"destroy",value:function(){this.canvas.destroy()}},{key:"clear",value:function(){this.pen.clear()}},{key:"undo",value:function(){this.pen.undo()}},{key:"redo",value:function(){this.pen.redo()}},{key:"save",value:function(){}},{key:"getContentBoundingBox",value:function(n){return this.pen.getContentBoundingBox(n)}},{key:"getMaskedImageData",value:function(n){return this.pen.getMaskedImageData(n)}},{key:"isEmpty",value:function(){return this.pen.isEmpty()}},{key:"on",value:function(n,t){this._ee.on(n,t)}},{key:"emit",value:function(n,t){this._ee.emit(n,t)}},{key:"off",value:function(n,t){this._ee.off(n,t)}}]),s}();function K(s){if(s==="transparent")return!0;if(s.startsWith("rgba")){let n=/\d+(\.\d+)?/g,t=s.match(n);if(t!==null&&parseFloat(t[3])===0)return!0}return!1}var Q={data(){return{canvasid:null,signature:null,observer:null,options:{},saveCount:0}},mounted(){this.$nextTick(this.init)},methods:{checkAndEmitEmptyStatus(){setTimeout(()=>{if(this.signature){let s=this.signature.isEmpty();this.emit({isEmpty:s})}},0)},init(){var e;let s=this.$refs.limeSignature||this.$ownerInstance.$el;this.canvas=document.createElement("canvas"),this.canvas.style="width: 100%; height: 100%;",s.appendChild(this.canvas),this.signature=new J({el:this.canvas}),this.signature.pen.setOption(this.options);let n=this.signature.canvas.get("width"),t=this.signature.canvas.get("height");(e=this.canvas)==null||e.addEventListener("touchend",this.checkAndEmitEmptyStatus.bind(this)),this.emit({changeSize:{width:n,height:t}})},redo(s){s&&this.signature&&(this.signature.redo(),this.checkAndEmitEmptyStatus())},undo(s){s&&this.signature&&(this.signature.undo(),this.checkAndEmitEmptyStatus())},clear(s){s&&this.signature&&(this.signature.clear(),this.checkAndEmitEmptyStatus())},destroy(){var s;this.canvas&&((s=this.canvas)==null||s.removeEventListener("touchend",this.checkAndEmitEmptyStatus.bind(this)),this.canvas.remove())},mask(s={}){if(this.signature){let{destWidth:n=0,destHeight:t=0}=JSON.parse(s),e=document.createElement("canvas"),i=e.getContext("2d"),a=this.signature.canvas.get("pixelRatio"),o=this.signature.canvas.get("width"),r=this.signature.canvas.get("height"),h=this.signature.canvas.get("context");e.width=o*a,e.height=r*a;let u=h.getImageData(0,0,o*a,r*a);for(let c=0;c<u.data.length;c+=4)u.data[c+3]===0?(u.data[c]=0,u.data[c+1]=0,u.data[c+2]=0):(u.data[c]=255,u.data[c+1]=255,u.data[c+2]=255);if(i.putImageData(u,0,0),n&&t){let c=document.createElement("canvas");c.width=n,c.height=t,c.getContext("2d").drawImage(e,0,0,n,t),e.remove(),e=c}this.emit({save:e.toDataURL()}),e.remove()}},save(s){let{fileType:n="png",quality:t=1,n:e,destWidth:i=0,destHeight:a=0}=JSON.parse(s),o=`image/${n}`.replace(/jpg/,"jpeg");if(e!==this.saveCount){this.saveCount=e;let{backgroundColor:r,backgroundImage:h,landscape:u,boundingBox:c}=this.options,l=u||r||c||i&&a,v=this.signature.canvas.get("el").toDataURL(!l&&o,!l&&t);if(l){let d=document.createElement("canvas"),g=this.signature.canvas.get("pixelRatio"),f=this.signature.canvas.get("width"),m=this.signature.canvas.get("height"),k=0,_=0,A=()=>{let y=[f,m];u&&y.reverse(),d.width=y[0]*g,d.height=y[1]*g;let F=[k,_,f,m,0,0,f,m].map(p=>p*g),w=d.getContext("2d");u&&(w.translate(0,f*g),w.rotate(-Math.PI/2)),r&&!K(r)&&(w.fillStyle=r,w.fillRect(0,0,f*g,m*g));let N=()=>{if(w.drawImage(this.signature.canvas.get("el"),...F),i&&a){let p=document.createElement("canvas");p.width=i,p.height=a,p.getContext("2d").drawImage(d,0,0,i,a),d.remove(),d=p}this.emit({save:d.toDataURL(o,t)}),d.remove()};if(h){let p=new Image;p.onload=()=>{w.drawImage(p,...F),N()},p.src=h}h||N()};if(c){let y=this.signature.getContentBoundingBox();f=y.width,m=y.height,k=y.startX,_=y.startY,A()}else A()}else this.emit({save:v})}},isEmpty(s){if(s&&this.signature){let n=this.signature.isEmpty();this.emit({isEmpty:n})}},emit(s){this.$ownerInstance.callMethod("onMessage",{detail:{data:[{event:s}]}})},update(s){s&&(this.signature?(this.options=s,this.signature.pen.setOption(s)):this.options=s)}}};var ft=Q;return at(gt);})();
